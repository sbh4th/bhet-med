<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mediation Example</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="mediation-example_files/libs/clipboard/clipboard.min.js"></script>
<script src="mediation-example_files/libs/quarto-html/quarto.js"></script>
<script src="mediation-example_files/libs/quarto-html/popper.min.js"></script>
<script src="mediation-example_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="mediation-example_files/libs/quarto-html/anchor.min.js"></script>
<link href="mediation-example_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="mediation-example_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="mediation-example_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="mediation-example_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="mediation-example_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="mediation-example_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="mediation-example_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mediation Example</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mediator)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(regmedint)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Purpose of this document is to just work through the key ideas for mediation using an empirical example. We’ll start with.</p>
<p>Let’s use the example data from the <code>mediator</code> package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> mediator<span class="sc">::</span><span class="fu">mediator</span>(<span class="at">data =</span> mediation_example,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">out.model =</span> <span class="fu">glm</span>(y <span class="sc">~</span> x <span class="sc">+</span> m_01 <span class="sc">+</span> c <span class="sc">+</span> x<span class="sc">*</span>m_01,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> mediation_example),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">med.model =</span> <span class="fu">glm</span>(m_01 <span class="sc">~</span> x <span class="sc">+</span> c, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> mediation_example),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">treat =</span> <span class="st">"x"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(mm, <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> Effect </th>
   <th style="text-align:right;"> Estimate </th>
   <th style="text-align:right;"> Lower 95% CI </th>
   <th style="text-align:right;"> Upper 95% CI </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> CDE </td>
   <td style="text-align:right;"> 0.279 </td>
   <td style="text-align:right;"> 0.058 </td>
   <td style="text-align:right;"> 1.342 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> NDE </td>
   <td style="text-align:right;"> 0.517 </td>
   <td style="text-align:right;"> 0.225 </td>
   <td style="text-align:right;"> 1.186 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> NIE </td>
   <td style="text-align:right;"> 1.049 </td>
   <td style="text-align:right;"> 0.905 </td>
   <td style="text-align:right;"> 1.216 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Total Effect </td>
   <td style="text-align:right;"> 0.542 </td>
   <td style="text-align:right;"> 0.235 </td>
   <td style="text-align:right;"> 1.253 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Proportion Mediated </td>
   <td style="text-align:right;"> -0.055 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>The estimate of the controlled direct effect (<span class="math inline">\(CDE\)</span>) here is 0.279 on the odds-ratio scale. We can see the estimates from the outcome regression if we just look at that model from the <code>mediator</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>out.model <span class="ot">=</span> <span class="fu">glm</span>(y <span class="sc">~</span> x <span class="sc">+</span> m_01 <span class="sc">+</span> c <span class="sc">+</span> x<span class="sc">*</span>m_01,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> mediation_example)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Mediator"</span> <span class="ot">=</span> out.model),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="fu">c</span>(<span class="st">"({std.error})"</span>, <span class="st">"conf.int"</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span><span class="st">'DF|Deviance|R2|AIC|BIC|Log.Lik|ICC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1"></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Mediator</div></th>
</tr>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Est. </th>
   <th style="text-align:center;"> (S.E. ) </th>
   <th style="text-align:center;"> &nbsp;2.5 % </th>
   <th style="text-align:center;"> &nbsp;97.5 % </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> −2.223 </td>
   <td style="text-align:center;"> (0.415) </td>
   <td style="text-align:center;"> −3.102 </td>
   <td style="text-align:center;"> −1.464 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> x </td>
   <td style="text-align:center;"> −1.276 </td>
   <td style="text-align:center;"> (0.801) </td>
   <td style="text-align:center;"> −3.183 </td>
   <td style="text-align:center;"> 0.122 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> m_01 </td>
   <td style="text-align:center;"> 0.362 </td>
   <td style="text-align:center;"> (0.460) </td>
   <td style="text-align:center;"> −0.537 </td>
   <td style="text-align:center;"> 1.287 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> c </td>
   <td style="text-align:center;"> 0.303 </td>
   <td style="text-align:center;"> (0.193) </td>
   <td style="text-align:center;"> −0.073 </td>
   <td style="text-align:center;"> 0.688 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1.5px"> x × m_01 </td>
   <td style="text-align:center;box-shadow: 0px 1.5px"> 0.908 </td>
   <td style="text-align:center;box-shadow: 0px 1.5px"> (0.951) </td>
   <td style="text-align:center;box-shadow: 0px 1.5px"> −0.849 </td>
   <td style="text-align:center;box-shadow: 0px 1.5px"> 3.020 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 250 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>The coefficient on <code>x</code> after adjustment for the mediator <code>m_01</code> and allowing for exposure-mediator interaction is -1.276. If we exponentiate it we get 0.279 from the table above, but this is inconsistent with the standard definition, where <span class="math inline">\(CDE = \beta_{1} + m\beta_{2}(a - a*)\)</span> (using the average value of <code>m_01</code> in the data of 0.504). Based on the coefficients in the table above, we should get <span class="math inline">\(CDE = -1.276 + 0.504*0.908(1 - 0) = -0.818\)</span>. If we exponentiate that coefficient we get <span class="math inline">\(CDE = 0.44\)</span>.</p>
<p>How about with the <code>regmedint</code> package, which also does mediation analysis? Let’s have a look.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>regmedint_obj <span class="ot">&lt;-</span> <span class="fu">regmedint</span>(<span class="at">data =</span> mediation_example,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a> <span class="at">yvar =</span> <span class="st">"y"</span>, <span class="at">avar =</span> <span class="st">"x"</span>, <span class="at">mvar =</span> <span class="st">"m_01"</span>, <span class="at">cvar =</span> <span class="fu">c</span>(<span class="st">"c"</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> <span class="do">## Values at which effects are evaluated</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a> <span class="at">a0 =</span> <span class="dv">0</span>, <span class="at">a1 =</span> <span class="dv">1</span>, <span class="at">m_cde =</span> <span class="fl">0.504</span>, <span class="at">c_cond =</span> <span class="dv">1</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> <span class="do">## Model types</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> <span class="at">mreg =</span> <span class="st">"logistic"</span>, <span class="at">yreg =</span> <span class="st">"logistic"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a> <span class="do">## Additional specification</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a> <span class="at">interaction =</span> <span class="cn">TRUE</span>, <span class="at">casecontrol =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regmedint_obj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>### Mediator model

Call:
glm(formula = m_01 ~ x + c, family = binomial(link = "logit"), 
    data = data)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept) -0.08428    0.20792  -0.405    0.685
x            0.17187    0.25771   0.667    0.505
c            0.02975    0.12520   0.238    0.812

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 346.56  on 249  degrees of freedom
Residual deviance: 346.06  on 247  degrees of freedom
AIC: 352.06

Number of Fisher Scoring iterations: 3

### Outcome model

Call:
glm(formula = y ~ x + m_01 + x:m_01 + c, family = binomial(link = "logit"), 
    data = data)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -2.2235     0.4150  -5.358 8.42e-08 ***
x            -1.2760     0.8010  -1.593    0.111    
m_01          0.3625     0.4604   0.787    0.431    
c             0.3030     0.1929   1.571    0.116    
x:m_01        0.9077     0.9510   0.954    0.340    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 191.28  on 249  degrees of freedom
Residual deviance: 182.97  on 245  degrees of freedom
AIC: 192.97

Number of Fisher Scoring iterations: 5

### Mediation analysis 
             est         se          Z          p       lower      upper
cde  -0.81853045 0.47303479 -1.7303811 0.08356221 -1.74566161 0.10860070
pnde -0.65961996 0.42342992 -1.5578020 0.11928020 -1.48952736 0.17028743
tnie  0.04780148 0.07524696  0.6352613 0.52525799 -0.09967985 0.19528282
tnde -0.62716773 0.42597143 -1.4723235 0.14093354 -1.46205639 0.20772092
pnie  0.01534925 0.02980978  0.5149068 0.60661818 -0.04307683 0.07377534
te   -0.61181848 0.42708932 -1.4325305 0.15199206 -1.44889817 0.22526121
pm   -0.05531882 0.10531524 -0.5252689 0.59939629 -0.26173291 0.15109527

Evaluated at:
avar: x
 a1 (intervened value of avar) = 1
 a0 (reference value of avar)  = 0
mvar: m_01
 m_cde (intervend value of mvar for cde) = 0.504
cvar: c
 c_cond (covariate vector value) = 1

Note that effect estimates can vary over m_cde and c_cond values when interaction = TRUE.</code></pre>
</div>
</div>
<p>Here we get a different answer for the <span class="math inline">\(CDE\)</span>, and the estimate from <code>regmedint</code> is -0.818, which is what we calculated above.</p>
<p>But what about on the absolute scale? What is the <span class="math inline">\(CDE\)</span> on the risk difference scale? We can start by doing this by hand, using the inverse logit function. If we take the outcome model we fit above, we can get the predicted probabilities at different levels of the mediator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> out.model<span class="sc">$</span>coefficients[<span class="dv">1</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>bx <span class="ot">&lt;-</span> out.model<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>bm <span class="ot">&lt;-</span> out.model<span class="sc">$</span>coefficients[<span class="dv">3</span>]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>bc <span class="ot">&lt;-</span> out.model<span class="sc">$</span>coefficients[<span class="dv">4</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>bxm <span class="ot">&lt;-</span> out.model<span class="sc">$</span>coefficients[<span class="dv">5</span>]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># exposed, m at average</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>ema <span class="ot">&lt;-</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> (bx<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bm<span class="sc">*</span><span class="fl">0.504</span>) <span class="sc">+</span> (bc<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bxm<span class="sc">*</span><span class="dv">1</span><span class="sc">*</span><span class="fl">0.504</span>)) <span class="sc">/</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> (bx<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bm<span class="sc">*</span><span class="fl">0.504</span>) <span class="sc">+</span> (bc<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bxm<span class="sc">*</span><span class="dv">1</span><span class="sc">*</span><span class="fl">0.504</span>)))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># unexposed, m at average</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>uma <span class="ot">&lt;-</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> (bx<span class="sc">*</span><span class="dv">0</span>) <span class="sc">+</span> (bm<span class="sc">*</span><span class="fl">0.504</span>) <span class="sc">+</span> (bc<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bxm<span class="sc">*</span><span class="dv">0</span><span class="sc">*</span><span class="fl">0.504</span>)) <span class="sc">/</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> (bx<span class="sc">*</span><span class="dv">0</span>) <span class="sc">+</span> (bm<span class="sc">*</span><span class="fl">0.504</span>) <span class="sc">+</span> (bc<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bxm<span class="sc">*</span><span class="dv">0</span><span class="sc">*</span><span class="fl">0.504</span>)))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># exposed, m at 1</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>em1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> (bx<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bm<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bc<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bxm<span class="sc">*</span><span class="dv">1</span><span class="sc">*</span><span class="dv">1</span>)) <span class="sc">/</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> (bx<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bm<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bc<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bxm<span class="sc">*</span><span class="dv">1</span><span class="sc">*</span><span class="dv">1</span>)))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># unexposed, m at 1</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>um1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> (bx<span class="sc">*</span><span class="dv">0</span>) <span class="sc">+</span> (bm<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bc<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bxm<span class="sc">*</span><span class="dv">0</span><span class="sc">*</span><span class="dv">1</span>)) <span class="sc">/</span> </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(b0 <span class="sc">+</span> (bx<span class="sc">*</span><span class="dv">0</span>) <span class="sc">+</span> (bm<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bc<span class="sc">*</span><span class="dv">1</span>) <span class="sc">+</span> (bxm<span class="sc">*</span><span class="dv">0</span><span class="sc">*</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we set the mediator at its average value of 0.504, we get the following risks for exposed and unexposed populations:</p>
<p>0.072 0.15</p>
<p>And the difference between those risks is:</p>
<p>-0.078</p>
<p>We can do the same under a situation where we set the mediator to a different value of 1</p>
<p>0.127 0.174</p>
<p>And the difference between those risks is:</p>
<p>-0.047</p>
<p>That’s fine for point estimates, but it doesn’t give us measures of precision, so let’s use the <code>marginaleffects</code> package to do that. Using the outcome model above, we’ll use the <code>avg_predictions</code> function to get the estimates for each exposure status, and the <code>avg_slopes</code> to get the difference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>apm <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(out.model, <span class="at">variables =</span> <span class="st">"x"</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">m_01 =</span> <span class="fl">0.504</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(apm, <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> rowid </th>
   <th style="text-align:right;"> rowidcf </th>
   <th style="text-align:right;"> x </th>
   <th style="text-align:right;"> estimate </th>
   <th style="text-align:right;"> p.value </th>
   <th style="text-align:right;"> s.value </th>
   <th style="text-align:right;"> conf.low </th>
   <th style="text-align:right;"> conf.high </th>
   <th style="text-align:right;"> y </th>
   <th style="text-align:right;"> m_01 </th>
   <th style="text-align:right;"> c </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.150 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 42.777 </td>
   <td style="text-align:right;"> 0.100 </td>
   <td style="text-align:right;"> 0.219 </td>
   <td style="text-align:right;"> 0.128 </td>
   <td style="text-align:right;"> 0.504 </td>
   <td style="text-align:right;"> 1.015 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.072 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 30.122 </td>
   <td style="text-align:right;"> 0.033 </td>
   <td style="text-align:right;"> 0.150 </td>
   <td style="text-align:right;"> 0.128 </td>
   <td style="text-align:right;"> 0.504 </td>
   <td style="text-align:right;"> 1.015 </td>
  </tr>
</tbody>
</table>

</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>asm <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(out.model, <span class="at">variables =</span> <span class="st">"x"</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">m_01 =</span> <span class="fl">0.504</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(asm, <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> rowid </th>
   <th style="text-align:left;"> term </th>
   <th style="text-align:left;"> contrast </th>
   <th style="text-align:right;"> estimate </th>
   <th style="text-align:right;"> std.error </th>
   <th style="text-align:right;"> statistic </th>
   <th style="text-align:right;"> p.value </th>
   <th style="text-align:right;"> s.value </th>
   <th style="text-align:right;"> conf.low </th>
   <th style="text-align:right;"> conf.high </th>
   <th style="text-align:right;"> predicted_lo </th>
   <th style="text-align:right;"> predicted_hi </th>
   <th style="text-align:right;"> predicted </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> x </td>
   <td style="text-align:left;"> 1 - 0 </td>
   <td style="text-align:right;"> -0.078 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> -1.925 </td>
   <td style="text-align:right;"> 0.054 </td>
   <td style="text-align:right;"> 4.205 </td>
   <td style="text-align:right;"> -0.157 </td>
   <td style="text-align:right;"> 0.001 </td>
   <td style="text-align:right;"> 0.15 </td>
   <td style="text-align:right;"> 0.072 </td>
   <td style="text-align:right;"> 0.112 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>These are the same estimates we got by hand above. Let’s do the same, but set the mediator to a value of 1 rather than the mean of 0.504.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ap1 <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(out.model, <span class="at">variables =</span> <span class="st">"x"</span>, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">m_01 =</span> <span class="dv">1</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(ap1, <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> rowid </th>
   <th style="text-align:right;"> rowidcf </th>
   <th style="text-align:right;"> x </th>
   <th style="text-align:right;"> estimate </th>
   <th style="text-align:right;"> p.value </th>
   <th style="text-align:right;"> s.value </th>
   <th style="text-align:right;"> conf.low </th>
   <th style="text-align:right;"> conf.high </th>
   <th style="text-align:right;"> y </th>
   <th style="text-align:right;"> m_01 </th>
   <th style="text-align:right;"> c </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.175 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 20.507 </td>
   <td style="text-align:right;"> 0.103 </td>
   <td style="text-align:right;"> 0.281 </td>
   <td style="text-align:right;"> 0.128 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1.015 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.128 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 18.736 </td>
   <td style="text-align:right;"> 0.062 </td>
   <td style="text-align:right;"> 0.245 </td>
   <td style="text-align:right;"> 0.128 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1.015 </td>
  </tr>
</tbody>
</table>

</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>as1 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(out.model, <span class="at">variables =</span> <span class="st">"x"</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">m_01 =</span> <span class="dv">1</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(as1, <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> rowid </th>
   <th style="text-align:left;"> term </th>
   <th style="text-align:left;"> contrast </th>
   <th style="text-align:right;"> estimate </th>
   <th style="text-align:right;"> std.error </th>
   <th style="text-align:right;"> statistic </th>
   <th style="text-align:right;"> p.value </th>
   <th style="text-align:right;"> s.value </th>
   <th style="text-align:right;"> conf.low </th>
   <th style="text-align:right;"> conf.high </th>
   <th style="text-align:right;"> predicted_lo </th>
   <th style="text-align:right;"> predicted_hi </th>
   <th style="text-align:right;"> predicted </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> x </td>
   <td style="text-align:left;"> 1 - 0 </td>
   <td style="text-align:right;"> -0.047 </td>
   <td style="text-align:right;"> 0.064 </td>
   <td style="text-align:right;"> -0.738 </td>
   <td style="text-align:right;"> 0.461 </td>
   <td style="text-align:right;"> 1.118 </td>
   <td style="text-align:right;"> -0.172 </td>
   <td style="text-align:right;"> 0.078 </td>
   <td style="text-align:right;"> 0.175 </td>
   <td style="text-align:right;"> 0.128 </td>
   <td style="text-align:right;"> 0.154 </td>
  </tr>
</tbody>
</table>

</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>